---
phase: 09-annotation-interface
plan: 07
type: execute
wave: 4
depends_on: ["09-01", "09-05"]
files_modified:
  - apps/web/src/pages/ReviewPage.tsx
  - apps/web/src/components/review/ReviewSideBySide.tsx
  - apps/web/src/components/review/ReviewActions.tsx
  - apps/web/src/components/review/ReviewComments.tsx
  - apps/web/src/components/review/index.ts
  - apps/web/src/hooks/useReview.ts
  - apps/web/src/api/reviews.ts
  - apps/web/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Reviewer sees original annotation alongside correction area"
    - "Reviewer can approve, reject, or request changes"
    - "Inline comments can be attached to specific fields"
  artifacts:
    - path: "apps/web/src/pages/ReviewPage.tsx"
      provides: "Review page component"
      min_lines: 100
    - path: "apps/web/src/components/review/ReviewActions.tsx"
      provides: "Review action buttons"
      exports: ["ReviewActions"]
  key_links:
    - from: "apps/web/src/pages/ReviewPage.tsx"
      to: "/api/v1/tasks/{taskId}/reviews"
      via: "submitReview API call"
      pattern: "submitReview"
---

<objective>
Build review interface with side-by-side view and reviewer actions.

Purpose: Enable reviewers to evaluate annotations with approve/reject/request changes actions.
Output: ReviewPage with original annotation display, correction area, and action buttons.
</objective>

<execution_context>
@/Users/parthpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/parthpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-annotation-interface/09-CONTEXT.md
@.planning/phases/09-annotation-interface/09-01-SUMMARY.md
@.planning/phases/09-annotation-interface/09-05-SUMMARY.md
@packages/@glyph/types/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create review API client and hook</name>
  <files>
    apps/web/src/api/reviews.ts
    apps/web/src/api/index.ts
    apps/web/src/hooks/useReview.ts
    apps/web/src/hooks/index.ts
  </files>
  <action>
Create review API and hooks:

**apps/web/src/api/reviews.ts:**
- getTaskForReview(taskId: string): Promise&lt;{ task, annotation, layout }&gt;
  - GET /tasks/{taskId}/review
- SubmitReviewRequest: { annotation_id, action: ReviewAction, corrected_data?, summary_note? }
- submitReview(taskId: string, request: SubmitReviewRequest): Promise&lt;Review&gt;
  - POST /tasks/{taskId}/reviews
- AddCommentRequest: { path: string, content: string }
- addReviewComment(taskId: string, reviewId: string, request: AddCommentRequest): Promise&lt;ReviewComment&gt;
  - POST /tasks/{taskId}/reviews/{reviewId}/comments
- getReviews(taskId: string): Promise&lt;Review[]&gt;
  - GET /tasks/{taskId}/reviews

**apps/web/src/hooks/useReview.ts:**
- useTaskForReview(taskId: string | undefined)
  - React Query hook for getTaskForReview
- useSubmitReview(taskId: string)
  - useMutation for submitReview
  - onSuccess: invalidate queries, show toast with action label
  - onError: show error toast
  </action>
  <verify>pnpm --filter web build compiles</verify>
  <done>Review API and hooks created</done>
</task>

<task type="auto">
  <name>Task 2: Create review components</name>
  <files>
    apps/web/src/components/review/ReviewSideBySide.tsx
    apps/web/src/components/review/ReviewActions.tsx
    apps/web/src/components/review/ReviewComments.tsx
    apps/web/src/components/review/index.ts
  </files>
  <action>
Create review UI components:

**ReviewSideBySide.tsx:**
Props: layout, originalAnnotation, taskInput, correctedData, onCorrectionChange, readOnly?

- Grid with 2 columns
- Left: "Original Annotation" header, LayoutRenderer with original data (read-only)
- Right: "Your Corrections" header (or "Corrected Version" if readOnly), LayoutRenderer with corrected data

**ReviewActions.tsx:**
Props: onAction: (action: ReviewAction, note?: string) => void, isSubmitting?, hasCorrectedData?

- State for showing note input and pending action
- Request Changes button: opens note textarea
- Reject button: triggers onAction('reject')
- Approve button: shows "Approve with Edits" if hasCorrectedData
- When note input shown: textarea, Submit Request and Cancel buttons
- All buttons show loading state when isSubmitting

**ReviewComments.tsx:** (optional, for inline comments later)
- Simple list of comments with path and content
- Can be placeholder for now

Export all from index.ts.
  </action>
  <verify>Components compile without errors</verify>
  <done>Review components created</done>
</task>

<task type="auto">
  <name>Task 3: Create ReviewPage and add route</name>
  <files>
    apps/web/src/pages/ReviewPage.tsx
    apps/web/src/App.tsx
  </files>
  <action>
Create ReviewPage and add route:

**ReviewPage.tsx:**
- Get taskId from useParams
- Use useTaskForReview hook
- State: correctedData (initialized from annotation.data), selectedAnnotation
- Initialize correctedData in useEffect when data loads
- handleAction: compare correctedData with original, include corrected_data if changed
- Call submitMutation.mutateAsync, navigate to /queue on success

Layout:
1. Header with "Review Task" and annotator info
2. Flex-1 container with ReviewSideBySide
3. ReviewActions footer

Loading/error states as usual.

**Update App.tsx:**
Add route: &lt;Route path="/review/:taskId" element={&lt;ReviewPage /&gt;} /&gt;
  </action>
  <verify>Review page loads and actions work</verify>
  <done>Review page created and routed</done>
</task>

</tasks>

<verification>
- Navigate to /review/:taskId
- Original annotation shows on left
- Corrections editable on right
- Approve/Reject/Request Changes buttons work
- Summary note required for Request Changes
</verification>

<success_criteria>
- Side-by-side view displays original and correction
- Reviewer can edit correction side
- All three review actions work
- Request Changes requires note
- After action, navigates to queue
</success_criteria>

<output>
After completion, create .planning/phases/09-annotation-interface/09-07-SUMMARY.md
</output>
