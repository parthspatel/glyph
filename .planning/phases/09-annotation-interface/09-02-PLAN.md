---
phase: 09-annotation-interface
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/pages/AnnotatePage.tsx
  - apps/web/src/components/annotation/AnnotationToolbar.tsx
  - apps/web/src/components/annotation/SaveStatus.tsx
  - apps/web/src/components/annotation/index.ts
  - apps/web/src/hooks/useTask.ts
  - apps/web/src/api/tasks.ts
autonomous: true

must_haves:
  truths:
    - "Annotation page loads task data and renders layout"
    - "Toolbar displays and can collapse"
    - "Save status indicator is visible"
  artifacts:
    - path: "apps/web/src/pages/AnnotatePage.tsx"
      provides: "Main annotation page"
      min_lines: 100
    - path: "apps/web/src/components/annotation/AnnotationToolbar.tsx"
      provides: "Collapsible toolbar component"
      min_lines: 50
  key_links:
    - from: "apps/web/src/pages/AnnotatePage.tsx"
      to: "@glyph/layout-runtime"
      via: "LayoutRenderer import"
      pattern: "LayoutRenderer"
---

<objective>
Create the annotation page structure with collapsible toolbar and LayoutRenderer integration.

Purpose: Establish the annotator workspace shell that hosts the layout-controlled content.
Output: AnnotatePage with toolbar, save status indicator, and LayoutRenderer integration.
</objective>

<execution_context>
@/Users/parthpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/parthpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-annotation-interface/09-CONTEXT.md
@.planning/phases/09-annotation-interface/09-RESEARCH.md
@packages/@glyph/layout-runtime/src/LayoutRenderer.tsx
@packages/@glyph/layout-runtime/src/types.ts
@apps/web/src/pages/AnnotatePage.tsx
@apps/web/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create task fetching hook and API</name>
  <files>
    apps/web/src/hooks/useTask.ts
    apps/web/src/api/tasks.ts
    apps/web/src/api/index.ts
    apps/web/src/hooks/index.ts
  </files>
  <action>
Create task fetching utilities:

**apps/web/src/api/tasks.ts:**
- getTaskForAnnotation(taskId: string): Promise&lt;TaskWithLayout&gt;
- TaskWithLayout extends Task with layout: Layout, project_name: string, instructions?: string

**apps/web/src/hooks/useTask.ts:**
- useTaskForAnnotation(taskId: string | undefined) - React Query hook
- queryKey: ['task', taskId, 'annotate']
- enabled: !!taskId

Export from index files.
  </action>
  <verify>pnpm --filter web build compiles without errors</verify>
  <done>Task fetching hook created with layout data</done>
</task>

<task type="auto">
  <name>Task 2: Create AnnotationToolbar and SaveStatus components</name>
  <files>
    apps/web/src/components/annotation/AnnotationToolbar.tsx
    apps/web/src/components/annotation/SaveStatus.tsx
    apps/web/src/components/annotation/index.ts
  </files>
  <action>
Create toolbar components:

**SaveStatus.tsx:**
- SaveStatusState type: 'idle' | 'pending' | 'saving' | { saved: Date } | { error: string }
- Display "Saving..." during save
- Display "Draft saved at X:XX PM" with Cloud icon after save
- Display error state with AlertCircle icon

**AnnotationToolbar.tsx:**
- Collapsible toolbar with localStorage persistence
- Props: taskInfo, saveStatus, onInstructionsClick, onShortcutsClick, onSubmit, onSkip, isSubmitting
- Collapsed state: just SaveStatus and expand button
- Expanded state: TaskInfo, SaveStatus, Instructions button, Shortcuts button, Skip button, Submit button, collapse button
- Use lucide-react icons: ChevronUp, ChevronDown, HelpCircle, Send, SkipForward, FileText

Export from index.ts.
  </action>
  <verify>Components render without errors in dev server</verify>
  <done>Toolbar and SaveStatus components created</done>
</task>

<task type="auto">
  <name>Task 3: Build AnnotatePage with LayoutRenderer integration</name>
  <files>apps/web/src/pages/AnnotatePage.tsx</files>
  <action>
Rebuild AnnotatePage to use LayoutRenderer and toolbar:

- Get taskId from useParams
- Use useTaskForAnnotation hook to fetch task with layout
- State: output (annotation data), saveStatus, showInstructions, showShortcuts
- handleOutputChange: update output state, set saveStatus to 'pending'
- handleSubmit: placeholder for Plan 05
- handleSkip: placeholder for Plan 04

Layout structure:
1. AnnotationToolbar at top
2. Flex-1 container with LayoutRenderer
3. Placeholder comments for InstructionsPanel and ShortcutsModal

Loading state: Skeleton components
Error state: Error message display

LayoutRenderer context:
- input: task.input_data
- output: current output state
- suggestions: {} (empty for now)
- previous: [] (empty for now)
  </action>
  <verify>Page loads and displays layout: pnpm --filter web dev and navigate to /annotate/:taskId</verify>
  <done>AnnotatePage renders with toolbar and LayoutRenderer</done>
</task>

</tasks>

<verification>
- pnpm --filter web build succeeds
- AnnotatePage renders task with toolbar
- Toolbar collapse state persists in localStorage
- SaveStatus displays appropriate states
</verification>

<success_criteria>
- Annotation page loads task data
- Toolbar is visible and collapsible
- LayoutRenderer renders the task layout
- Save status indicator shows state
</success_criteria>

<output>
After completion, create .planning/phases/09-annotation-interface/09-02-SUMMARY.md
</output>
