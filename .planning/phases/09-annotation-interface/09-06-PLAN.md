---
phase: 09-annotation-interface
plan: 06
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - apps/web/src/components/annotation/InstructionsPanel.tsx
  - apps/web/src/components/annotation/ShortcutsModal.tsx
  - apps/web/src/pages/AnnotatePage.tsx
  - apps/web/package.json
autonomous: true

must_haves:
  truths:
    - "Instructions panel expands/collapses when clicked"
    - "Pressing ? opens shortcuts modal"
    - "Shortcuts modal shows context-aware shortcuts"
  artifacts:
    - path: "apps/web/src/components/annotation/InstructionsPanel.tsx"
      provides: "Expandable instructions component"
      min_lines: 40
    - path: "apps/web/src/components/annotation/ShortcutsModal.tsx"
      provides: "Keyboard shortcuts cheatsheet"
      min_lines: 60
  key_links:
    - from: "apps/web/src/pages/AnnotatePage.tsx"
      to: "react-hotkeys-hook"
      via: "useHotkeys import"
      pattern: "useHotkeys.*\\?"
---

<objective>
Create instructions panel and keyboard shortcuts cheatsheet modal.

Purpose: Provide annotators with task guidance and shortcut discoverability.
Output: Expandable instructions panel and shortcuts modal accessible via ? key.
</objective>

<execution_context>
@/Users/parthpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/parthpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09-annotation-interface/09-CONTEXT.md
@.planning/phases/09-annotation-interface/09-02-SUMMARY.md
@packages/@glyph/layout-runtime/src/shortcuts/registry.ts
@packages/@glyph/layout-runtime/src/shortcuts/hooks.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add react-collapsed and create InstructionsPanel</name>
  <files>
    apps/web/package.json
    apps/web/src/components/annotation/InstructionsPanel.tsx
    apps/web/src/components/annotation/index.ts
  </files>
  <action>
Install react-collapsed and create instructions panel:

cd apps/web and pnpm add react-collapsed

**InstructionsPanel.tsx:**
Props: instructions?: string, isExpanded: boolean, onToggle: () => void

- Use useCollapse hook from react-collapsed
- Return null if no instructions
- Clickable header with "Instructions" label and FileText icon
- ChevronDown/ChevronUp based on expanded state
- Collapsible content area with prose styling
- Render HTML instructions (use dangerouslySetInnerHTML or markdown renderer)
- Background: bg-muted/30, border-b

Export from index.ts.
  </action>
  <verify>pnpm --filter web build compiles</verify>
  <done>Instructions panel with expand/collapse created</done>
</task>

<task type="auto">
  <name>Task 2: Create ShortcutsModal and integrate keyboard handling</name>
  <files>
    apps/web/src/components/annotation/ShortcutsModal.tsx
    apps/web/src/components/annotation/index.ts
    apps/web/src/pages/AnnotatePage.tsx
  </files>
  <action>
Create shortcuts cheatsheet modal:

**ShortcutsModal.tsx:**
Props: open: boolean, onOpenChange: (open: boolean) => void

- Use Dialog component
- Get shortcuts from getShortcutRegistry() from @glyph/layout-runtime
- Group shortcuts:
  1. General: Ctrl+Enter (Submit), Ctrl+S (Save), Ctrl+Z (Undo), Ctrl+Shift+Z (Redo), ? (Help)
  2. Layout Shortcuts: filter by scope === 'layout'
  3. Component Shortcuts: filter by scope === 'component'
- Filter out empty groups
- Display each shortcut with description on left, kbd element on right
- Style kbd with bg-muted, rounded, monospace font

**Update AnnotatePage.tsx:**
- Import useHotkeys from react-hotkeys-hook (or from @glyph/layout-runtime if re-exported)
- Add useHotkeys('?', () => setShowShortcuts(true), { enableOnFormTags: false })
- Add useHotkeys('ctrl+enter', handleSubmit, { enableOnFormTags: true })
- Add useHotkeys('ctrl+s', () => draft.save(output), { enableOnFormTags: true, preventDefault: true })
- Render InstructionsPanel below toolbar, above LayoutRenderer
- Render ShortcutsModal with showShortcuts state

Export ShortcutsModal from index.ts.
  </action>
  <verify>Press ? to open shortcuts modal; Instructions panel expands/collapses</verify>
  <done>Instructions panel and shortcuts modal integrated</done>
</task>

</tasks>

<verification>
- Instructions panel shows and expands/collapses
- Pressing ? opens shortcuts modal
- Modal shows all available shortcuts grouped by context
- Ctrl+Enter triggers submit
- Ctrl+S triggers save
- Ctrl+Z/Ctrl+Shift+Z trigger undo/redo
</verification>

<success_criteria>
- Instructions panel expandable via click
- Shortcuts modal opens with ? key
- Shortcuts grouped by General/Layout/Component
- Reserved shortcuts work (submit, save, undo, redo)
</success_criteria>

<output>
After completion, create .planning/phases/09-annotation-interface/09-06-SUMMARY.md
</output>
