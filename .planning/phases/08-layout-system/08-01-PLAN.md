---
phase: 08-layout-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/@glyph/components/src/interfaces/index.ts
  - packages/@glyph/components/src/interfaces/annotation.ts
  - packages/@glyph/components/src/interfaces/layout.ts
  - packages/@glyph/components/src/interfaces/form.ts
  - packages/@glyph/components/src/interfaces/display.ts
  - packages/@glyph/components/src/interfaces/control.ts
  - packages/@glyph/components/src/interfaces/common.ts
  - packages/@glyph/components/package.json
autonomous: true

must_haves:
  truths:
    - "Component interfaces are JSON-serializable (WASM compatible)"
    - "Each component has props, callbacks, and slots defined"
    - "Interfaces match existing component implementations"
  artifacts:
    - path: "packages/@glyph/components/src/interfaces/index.ts"
      provides: "Aggregated interface exports"
      exports: ["ComponentInterface", "ComponentInterfaces"]
    - path: "packages/@glyph/components/src/interfaces/annotation.ts"
      provides: "Annotation component interfaces"
      exports: ["NERTaggerInterface", "ClassificationInterface", "BoundingBoxInterface"]
  key_links:
    - from: "interfaces/annotation.ts"
      to: "annotation/NERTagger.tsx"
      via: "Type compatibility"
      pattern: "NERTaggerProps"
---

<objective>
Define WASM-compatible interface schemas for all Tier 1 components.

Purpose: Enable WASM components alongside React components by establishing a language-agnostic contract for props, callbacks, and slots. This is the foundation for tooling (autocomplete, validation) and future WASM implementations.

Output: TypeScript interface definitions that describe component APIs in a serializable format. These interfaces serve as the "WIT-like" contract per CONTEXT decisions.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-layout-system/08-CONTEXT.md
@.planning/phases/08-layout-system/08-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create common interface types</name>
  <files>packages/@glyph/components/src/interfaces/common.ts</files>
  <action>
Create the base types used across all component interfaces:

- JsonPrimitive, JsonValue, JsonObject for serialization
- ChangeEvent<T> for callback events (field, value, timestamp)
- UndoableCallbacks interface (onUndo, onRedo, requestUndo, requestRedo)
- ShortcutBinding (key, action)
- SlotContent (type: component|html|text, content, props)
- ValidationState (valid, errors array)
- ComponentMeta (name, version, category, description)
- ComponentInterface<P> with meta, props, callbacks, slots, shortcuts

All types must be JSON-serializable for WASM boundary crossing.
  </action>
  <verify>Run `cd packages/@glyph/components && pnpm typecheck` - should pass with no errors</verify>
  <done>Common interface types exist and are importable</done>
</task>

<task type="auto">
  <name>Task 2: Define annotation component interfaces</name>
  <files>packages/@glyph/components/src/interfaces/annotation.ts</files>
  <action>
Create interfaces for annotation components matching existing implementations:

- NERTaggerInterface: text, entityTypes, value, readOnly, suggestions, allowOverlapping, enableHotkeys
  - Callbacks: onChange, onAcceptSuggestion
  - Slots: header, entityTypeSelector
  - Shortcuts: addEntity, deleteEntity, cycleLabel

- ClassificationInterface: options, value, multiple, required
  - Callbacks: onChange
  - Shortcuts: selectOption (1-9)

- BoundingBoxInterface: imageUrl, boxes, labels, allowOverlapping
  - Callbacks: onChange
  - Slots: toolbar

- RelationInterface: entities, relations, relationTypes
  - Callbacks: onChange

- AudioSegmentInterface: audioUrl, segments, labels
  - Callbacks: onChange
  </action>
  <verify>Interfaces align with existing component Props types</verify>
  <done>All annotation component interfaces defined</done>
</task>

<task type="auto">
  <name>Task 3: Define layout and form component interfaces</name>
  <files>
    packages/@glyph/components/src/interfaces/layout.ts
    packages/@glyph/components/src/interfaces/form.ts
  </files>
  <action>
**layout.ts:**
- SectionInterface: title, description, collapsible, defaultExpanded
- GridInterface: columns, gap, minChildWidth
- BoxInterface: padding, margin, border, background
- ColumnInterface: span, offset
- HeaderInterface: level (1-6), text

**form.ts:**
- SelectInterface: options, value, placeholder, multiple, searchable, required
- TextAreaInterface: value, placeholder, rows, maxLength, required
- CheckboxInterface: label, checked, disabled
- RadioGroupInterface: options, value, name, required
  </action>
  <verify>Interfaces match existing form component props</verify>
  <done>Layout and form component interfaces defined</done>
</task>

<task type="auto">
  <name>Task 4: Define display and control component interfaces</name>
  <files>
    packages/@glyph/components/src/interfaces/display.ts
    packages/@glyph/components/src/interfaces/control.ts
  </files>
  <action>
**display.ts:**
- TextDisplayInterface: text, format (plain|markdown), highlightRanges
- ImageViewerInterface: src, alt, zoom, fit
- PDFViewerInterface: src, page, scale, highlights
- AudioPlayerInterface: src, currentTime, playbackRate
- VideoPlayerInterface: src, currentTime, playbackRate

**control.ts:**
- ShowInterface: when (boolean expression)
- ForEachInterface: items, as, key
- SwitchInterface: value, cases (map of value -> content)
- ButtonInterface: label, variant, onClick action
- SubmitButtonInterface: label, disabled, loading
- SkipButtonInterface: label, confirmMessage
  </action>
  <verify>All control flow interfaces support template logic</verify>
  <done>Display and control component interfaces defined</done>
</task>

<task type="auto">
  <name>Task 5: Create registry index and package exports</name>
  <files>
    packages/@glyph/components/src/interfaces/index.ts
    packages/@glyph/components/package.json
  </files>
  <action>
**index.ts:**
- Re-export all types from common.ts
- Re-export all interfaces from annotation.ts, layout.ts, form.ts, display.ts, control.ts
- Create ComponentInterfaces registry object mapping name -> interface

**package.json:**
Add export path:
```json
"./interfaces": {
  "types": "./src/interfaces/index.ts",
  "import": "./src/interfaces/index.ts"
}
```
  </action>
  <verify>Import `@glyph/components/interfaces` works in consuming packages</verify>
  <done>Package exports interfaces correctly</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes in @glyph/components
- All 6 interface files created (common, annotation, layout, form, display, control)
- ComponentInterfaces registry exports all 20+ interfaces
- Package.json exports ./interfaces path
</verification>

<success_criteria>
- Component interfaces are JSON-serializable
- Each interface has meta, props, callbacks, and slots
- Interfaces align with existing component Props types
- Ready for Component Registry (Plan 08-05) to consume
</success_criteria>
