---
phase: 05-project-management
plan: 09
type: execute
wave: 6
depends_on: [05-08]
files_modified:
  - apps/web/src/pages/ProjectDetailPage.tsx
  - apps/web/src/components/project/ProjectOverview.tsx
  - apps/web/src/components/project/ProjectActivity.tsx
  - apps/web/src/components/project/StatusTransitionDialog.tsx
autonomous: false

must_haves:
  truths:
    - "Project detail page renders at /projects/:id"
    - "Overview shows all sections without tabs"
    - "Status transitions work with confirmation"
    - "Activity feed shows recent events"
    - "Clone and template actions work"
  artifacts:
    - path: "apps/web/src/pages/ProjectDetailPage.tsx"
      provides: "Project detail/overview page"
      contains: "ProjectDetailPage"
---

<objective>
Create the project detail/overview page with activity feed and status management.

Purpose: Display project overview with all key information visible at a glance (no tabs). Show recent activity, enable status transitions, and provide actions like clone, archive, and activate.

Output: ProjectDetailPage at /projects/:id with overview, settings display, and activity feed.
</objective>

<context>
@.planning/phases/05-project-management/05-CONTEXT.md (overview page decisions)
@apps/web/src/pages/ (page patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProjectOverview component</name>
  <files>apps/web/src/components/project/ProjectOverview.tsx</files>
  <action>
Create apps/web/src/components/project/ProjectOverview.tsx:

```typescript
interface ProjectOverviewProps {
  project: Project;
}

export function ProjectOverview({ project }: ProjectOverviewProps) {
  return (
    <div className="space-y-6">
      {/* Header with status and actions */}
      <div className="flex items-start justify-between">
        <div>
          <h1 className="text-2xl font-bold">{project.name}</h1>
          <p className="text-gray-600 mt-1">{project.description}</p>
        </div>
        <div className="flex items-center gap-3">
          <StatusBadge status={project.status} />
          <ProjectActionsMenu project={project} />
        </div>
      </div>
      
      {/* Key metrics */}
      <div className="grid grid-cols-4 gap-4">
        <MetricCard
          label="Tasks"
          value={project.task_count ?? 0}
          icon={<ListIcon />}
        />
        <MetricCard
          label="Completion"
          value={`${project.completion_pct ?? 0}%`}
          icon={<CheckCircleIcon />}
        />
        <MetricCard
          label="Active Annotators"
          value={project.active_annotators ?? 0}
          icon={<UsersIcon />}
        />
        <MetricCard
          label="Data Sources"
          value={project.data_sources?.length ?? 0}
          icon={<DatabaseIcon />}
        />
      </div>
      
      {/* Settings summary section */}
      <section className="border rounded-lg p-4">
        <h2 className="font-semibold mb-4">Configuration</h2>
        <dl className="grid grid-cols-2 gap-4">
          <div>
            <dt className="text-sm text-gray-500">Project Type</dt>
            <dd className="font-medium">{project.project_type?.name ?? 'Not set'}</dd>
          </div>
          <div>
            <dt className="text-sm text-gray-500">Owner</dt>
            <dd className="font-medium">{project.created_by_user?.display_name}</dd>
          </div>
          <div>
            <dt className="text-sm text-gray-500">Created</dt>
            <dd className="font-medium">{formatDate(project.created_at)}</dd>
          </div>
          <div>
            <dt className="text-sm text-gray-500">Deadline</dt>
            <dd className="font-medium">
              {project.deadline ? formatDate(project.deadline) : 'No deadline'}
            </dd>
          </div>
        </dl>
        
        {/* Tags */}
        {project.tags?.length > 0 && (
          <div className="mt-4">
            <dt className="text-sm text-gray-500 mb-2">Tags</dt>
            <div className="flex flex-wrap gap-2">
              {project.tags.map(tag => (
                <span key={tag} className="px-2 py-1 bg-gray-100 rounded text-sm">
                  {tag}
                </span>
              ))}
            </div>
          </div>
        )}
      </section>
      
      {/* Schema section */}
      <section className="border rounded-lg p-4">
        <h2 className="font-semibold mb-4">Schemas</h2>
        <div className="grid grid-cols-2 gap-4">
          <div>
            <h3 className="text-sm text-gray-500 mb-2">Input Schema</h3>
            <SchemaPreview schema={project.project_type?.input_schema} />
          </div>
          <div>
            <h3 className="text-sm text-gray-500 mb-2">Output Schema</h3>
            <SchemaPreview schema={project.project_type?.output_schema} />
          </div>
        </div>
      </section>
      
      {/* Data sources section */}
      <section className="border rounded-lg p-4">
        <div className="flex items-center justify-between mb-4">
          <h2 className="font-semibold">Data Sources</h2>
          <Link to={`/projects/${project.id}/edit`} className="text-sm text-blue-600">
            Manage
          </Link>
        </div>
        {project.data_sources?.length > 0 ? (
          <ul className="space-y-3">
            {project.data_sources.map(ds => (
              <li key={ds.id} className="flex items-center justify-between p-3 bg-gray-50 rounded">
                <div className="flex items-center gap-3">
                  <DataSourceIcon type={ds.source_type} />
                  <div>
                    <p className="font-medium">{ds.name}</p>
                    <p className="text-sm text-gray-500">{ds.item_count} items</p>
                  </div>
                </div>
                <StatusIndicator active={ds.is_active} lastSync={ds.last_sync_at} />
              </li>
            ))}
          </ul>
        ) : (
          <p className="text-gray-500 text-sm">No data sources configured</p>
        )}
      </section>
      
      {/* Documentation section */}
      {project.documentation && (
        <section className="border rounded-lg p-4">
          <h2 className="font-semibold mb-4">Documentation</h2>
          <div className="prose prose-sm max-w-none">
            <Markdown>{project.documentation}</Markdown>
          </div>
        </section>
      )}
    </div>
  );
}

function MetricCard({ label, value, icon }) {
  return (
    <div className="border rounded-lg p-4">
      <div className="flex items-center gap-2 text-gray-500 mb-1">
        {icon}
        <span className="text-sm">{label}</span>
      </div>
      <p className="text-2xl font-bold">{value}</p>
    </div>
  );
}
```
  </action>
  <verify>
Component renders all sections.
Metrics display correctly.
Schema preview shows truncated JSON.
  </verify>
</task>

<task type="auto">
  <name>Task 2: Create ProjectActivity and StatusTransitionDialog</name>
  <files>apps/web/src/components/project/ProjectActivity.tsx, apps/web/src/components/project/StatusTransitionDialog.tsx</files>
  <action>
1. Create apps/web/src/components/project/ProjectActivity.tsx:

```typescript
interface ProjectActivityProps {
  projectId: string;
}

export function ProjectActivity({ projectId }: ProjectActivityProps) {
  const { data: events } = useProjectActivity(projectId, { limit: 20 });
  
  return (
    <section className="border rounded-lg p-4">
      <div className="flex items-center justify-between mb-4">
        <h2 className="font-semibold">Recent Activity</h2>
        <Link
          to={`/audit?project_id=${projectId}`}
          className="text-sm text-blue-600"
        >
          View all
        </Link>
      </div>
      
      {events?.length > 0 ? (
        <ul className="space-y-4">
          {events.map(event => (
            <li key={event.id} className="flex gap-3">
              <div className="shrink-0 mt-1">
                <ActivityIcon action={event.action} />
              </div>
              <div className="flex-1 min-w-0">
                <p className="text-sm">
                  <span className="font-medium">{event.actor_name}</span>
                  {' '}{activityMessage(event)}
                </p>
                <p className="text-xs text-gray-500">
                  {formatRelativeTime(event.timestamp)}
                </p>
              </div>
            </li>
          ))}
        </ul>
      ) : (
        <p className="text-sm text-gray-500">No recent activity</p>
      )}
    </section>
  );
}

function activityMessage(event: AuditEvent): string {
  switch (event.action) {
    case 'created': return 'created the project';
    case 'updated': return 'updated project settings';
    case 'status_changed': return `changed status to ${event.changes?.new_status}`;
    case 'data_source_added': return 'added a data source';
    // etc.
    default: return event.action;
  }
}
```

2. Create apps/web/src/components/project/StatusTransitionDialog.tsx:

```typescript
interface StatusTransitionDialogProps {
  project: Project;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  targetStatus: ProjectStatus;
}

export function StatusTransitionDialog({
  project,
  open,
  onOpenChange,
  targetStatus,
}: StatusTransitionDialogProps) {
  const updateStatus = useUpdateProjectStatus();
  const activateProject = useActivateProject();
  
  const isDestructive = ['archived', 'completed'].includes(targetStatus);
  const isActivation = targetStatus === 'active' && project.status === 'draft';
  
  const handleConfirm = async () => {
    if (isActivation) {
      await activateProject.mutateAsync(project.id);
    } else {
      await updateStatus.mutateAsync({ id: project.id, status: targetStatus });
    }
    onOpenChange(false);
  };
  
  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>
            {isActivation ? 'Activate Project' : `Change Status to ${targetStatus}`}
          </DialogTitle>
        </DialogHeader>
        
        {isActivation && (
          <div className="py-4">
            <p className="text-sm text-gray-600 mb-4">
              Before activating, please confirm all requirements are met:
            </p>
            <ActivationChecklist project={project} />
          </div>
        )}
        
        {isDestructive && (
          <div className="py-4">
            <p className="text-sm text-gray-600">
              {targetStatus === 'archived'
                ? 'Archiving will hide this project from active views. You can restore it later.'
                : 'Marking as completed will lock the project. Admins can still make corrections.'}
            </p>
          </div>
        )}
        
        <DialogFooter>
          <Button variant="outline" onClick={() => onOpenChange(false)}>
            Cancel
          </Button>
          <Button
            variant={isDestructive ? 'destructive' : 'default'}
            onClick={handleConfirm}
            disabled={updateStatus.isPending || activateProject.isPending}
          >
            {isActivation ? 'Activate' : 'Confirm'}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}

function ActivationChecklist({ project }: { project: Project }) {
  const requirements = [
    {
      label: 'Output schema defined',
      met: Boolean(project.project_type?.output_schema),
    },
    {
      label: 'At least one data source',
      met: (project.data_sources?.length ?? 0) > 0,
    },
    {
      label: 'Skill requirements set',
      met: (project.project_type?.skill_requirements?.length ?? 0) > 0,
    },
  ];
  
  const allMet = requirements.every(r => r.met);
  
  return (
    <ul className="space-y-2">
      {requirements.map((req, i) => (
        <li key={i} className="flex items-center gap-2 text-sm">
          {req.met ? (
            <CheckCircleIcon className="h-4 w-4 text-green-500" />
          ) : (
            <XCircleIcon className="h-4 w-4 text-red-400" />
          )}
          <span className={req.met ? 'text-gray-600' : 'text-red-600'}>
            {req.label}
          </span>
        </li>
      ))}
      {!allMet && (
        <li className="text-sm text-red-600 mt-2">
          Cannot activate until all requirements are met.
        </li>
      )}
    </ul>
  );
}
```
  </action>
  <verify>
Activity feed shows events.
Status dialog shows correct content per transition.
Activation validates requirements.
  </verify>
</task>

<task type="checkpoint">
  <name>Task 3: Create ProjectDetailPage and verify full flow</name>
  <files>apps/web/src/pages/ProjectDetailPage.tsx</files>
  <action>
1. Create apps/web/src/pages/ProjectDetailPage.tsx:

```typescript
import { useParams } from 'react-router-dom';
import { useProject } from '@/hooks/useProjects';
import { ProjectOverview } from '@/components/project/ProjectOverview';
import { ProjectActivity } from '@/components/project/ProjectActivity';
import { StatusTransitionDialog } from '@/components/project/StatusTransitionDialog';
import { useState } from 'react';

export function ProjectDetailPage() {
  const { id } = useParams<{ id: string }>();
  const { data: project, isLoading, error } = useProject(id!);
  const [statusDialog, setStatusDialog] = useState<{
    open: boolean;
    targetStatus: ProjectStatus | null;
  }>({ open: false, targetStatus: null });
  
  if (isLoading) return <ProjectDetailSkeleton />;
  if (error || !project) return <NotFound message="Project not found" />;
  
  const handleStatusChange = (status: ProjectStatus) => {
    setStatusDialog({ open: true, targetStatus: status });
  };
  
  return (
    <div className="container py-6 max-w-5xl">
      <div className="grid grid-cols-3 gap-6">
        {/* Main content - 2 columns */}
        <div className="col-span-2 space-y-6">
          <ProjectOverview
            project={project}
            onStatusChange={handleStatusChange}
          />
        </div>
        
        {/* Sidebar - 1 column */}
        <div className="space-y-6">
          {/* Quick actions */}
          <div className="border rounded-lg p-4">
            <h2 className="font-semibold mb-3">Actions</h2>
            <div className="space-y-2">
              <Button
                variant="outline"
                className="w-full justify-start"
                asChild
              >
                <Link to={`/projects/${id}/edit`}>
                  <EditIcon className="h-4 w-4 mr-2" />
                  Edit Project
                </Link>
              </Button>
              
              {project.status === 'draft' && (
                <Button
                  className="w-full justify-start"
                  onClick={() => handleStatusChange('active')}
                >
                  <PlayIcon className="h-4 w-4 mr-2" />
                  Activate Project
                </Button>
              )}
              
              {project.status === 'active' && (
                <Button
                  variant="outline"
                  className="w-full justify-start"
                  onClick={() => handleStatusChange('paused')}
                >
                  <PauseIcon className="h-4 w-4 mr-2" />
                  Pause Project
                </Button>
              )}
              
              <CloneProjectButton projectId={id!} />
            </div>
          </div>
          
          {/* Activity feed */}
          <ProjectActivity projectId={id!} />
        </div>
      </div>
      
      {statusDialog.targetStatus && (
        <StatusTransitionDialog
          project={project}
          open={statusDialog.open}
          onOpenChange={(open) => setStatusDialog({ ...statusDialog, open })}
          targetStatus={statusDialog.targetStatus}
        />
      )}
    </div>
  );
}
```

2. Add route:
```typescript
{ path: '/projects/:id', element: <ProjectDetailPage /> }
```

3. CHECKPOINT: Verify complete flow
   - Create a project from /projects/new
   - View it at /projects/:id
   - Edit it at /projects/:id/edit
   - Add data source (if backend supports)
   - Attempt to activate
   - View activity feed
  </action>
  <verify>
Navigate to /projects/:id - page loads.
All sections display correctly.
Status change dialogs work.
Edit button navigates to edit page.
Activity feed shows events.
Clone action creates new project.
  </verify>
  <checkpoint>
Manual verification required:
1. Create project flow: Name only -> Draft status
2. Edit project: Add schema, data source, skills
3. Activate: Should validate requirements
4. View activity: Should show create/update events
5. Clone: Should create copy in Draft

Report any issues before proceeding.
  </checkpoint>
</task>

</tasks>

<verification>
1. Project detail page renders at /projects/:id
2. Overview shows metrics, config, schemas, data sources
3. Activity feed shows recent events with relative times
4. Status transitions work with confirmation dialogs
5. Activation validates requirements before allowing
6. Clone creates new project in Draft status
7. Edit link navigates to edit page
</verification>

<success_criteria>
- Overview page with scrollable sections (no tabs)
- Key metrics prominently displayed
- Status badge with transition actions
- Activity feed with link to full audit log
- Confirmation dialogs for destructive actions
- Activation checklist shows requirement status
- Documentation renders markdown
</success_criteria>
