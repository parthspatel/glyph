---
plan_id: "4.1-06"
title: "Mobile Navigation and Human Verification"
phase: "4.1"
phase_name: "UX Navigation Flow"
wave: 3
approval: "checkpoint"
depends_on: ["4.1-03", "4.1-04", "4.1-05"]
files_modified:
  - apps/web/src/components/layout/MobileNav.tsx
  - apps/web/src/components/layout/AppLayout.tsx
  - apps/web/src/components/layout/index.ts
---

<objective>
Implement mobile bottom tab bar navigation for screens < 768px. Includes human verification checkpoint for the complete navigation system.

Purpose: Ensure mobile users have quick access to primary navigation actions.
Output: Mobile-responsive navigation complete, full UX verified by human.
</objective>

<context>
@.planning/phases/04.1-ux-navigation-flow/04.1-CONTEXT.md
@apps/web/src/components/layout/AppLayout.tsx
@apps/web/src/lib/navigation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileNav bottom tab bar</name>
  <files>
    apps/web/src/components/layout/MobileNav.tsx
    apps/web/src/components/layout/AppLayout.tsx
    apps/web/src/components/layout/index.ts
  </files>
  <action>
Create `apps/web/src/components/layout/MobileNav.tsx`:

```typescript
import { Link, useLocation } from "react-router-dom";
import { LayoutDashboard, FolderKanban, Users, ClipboardList, User } from "lucide-react";
import { useCurrentUser } from "@/hooks/useUser";
import { cn } from "@/lib/utils";

// Mobile-specific nav items (subset of main nav for limited space)
const mobileNavItems = [
  { href: "/", label: "Home", icon: LayoutDashboard },
  { href: "/projects", label: "Projects", icon: FolderKanban },
  { href: "/teams", label: "Teams", icon: Users },
  { href: "/tasks", label: "Tasks", icon: ClipboardList },
];

export function MobileNav() {
  const location = useLocation();
  const { data: user } = useCurrentUser();

  const isActive = (href: string) => {
    if (href === "/") return location.pathname === "/";
    return location.pathname.startsWith(href);
  };

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-50 border-t bg-background md:hidden">
      <div className="flex h-16 items-center justify-around">
        {mobileNavItems.map((item) => {
          const active = isActive(item.href);
          return (
            <Link
              key={item.href}
              to={item.href}
              className={cn(
                "flex flex-1 flex-col items-center justify-center gap-1 py-2 text-xs",
                active
                  ? "text-primary font-medium"
                  : "text-muted-foreground hover:text-foreground"
              )}
            >
              <item.icon className={cn("h-5 w-5", active && "text-primary")} />
              <span>{item.label}</span>
            </Link>
          );
        })}
        {/* Profile quick access */}
        <Link
          to={user ? `/users/${user.user_id}` : "/"}
          className={cn(
            "flex flex-1 flex-col items-center justify-center gap-1 py-2 text-xs",
            location.pathname.startsWith("/users/")
              ? "text-primary font-medium"
              : "text-muted-foreground hover:text-foreground"
          )}
        >
          <User className="h-5 w-5" />
          <span>Profile</span>
        </Link>
      </div>
    </nav>
  );
}
```

Update `apps/web/src/components/layout/AppLayout.tsx`:

```typescript
import { Outlet } from "react-router-dom";
import { SidebarProvider, SidebarInset, SidebarTrigger, useSidebar } from "@/components/ui/sidebar";
import { AppSidebar } from "./AppSidebar";
import { Breadcrumbs } from "./Breadcrumbs";
import { MobileNav } from "./MobileNav";
import { Separator } from "@/components/ui/separator";
import { cn } from "@/lib/utils";

const SIDEBAR_STATE_KEY = "glyph-sidebar-state";

function LayoutContent() {
  const { isMobile } = useSidebar();

  return (
    <>
      <AppSidebar />
      <SidebarInset>
        <header className="flex h-14 shrink-0 items-center gap-2 border-b px-4">
          <SidebarTrigger className="-ml-1" />
          <Separator orientation="vertical" className="mr-2 h-4" />
          <Breadcrumbs />
          <div className="flex-1" />
        </header>
        <main className={cn("flex-1 overflow-auto p-4", isMobile && "pb-20")}>
          <Outlet />
        </main>
      </SidebarInset>
      {isMobile && <MobileNav />}
    </>
  );
}

export function AppLayout() {
  const defaultOpen = localStorage.getItem(SIDEBAR_STATE_KEY) !== "false";

  const handleOpenChange = (open: boolean) => {
    localStorage.setItem(SIDEBAR_STATE_KEY, String(open));
  };

  return (
    <SidebarProvider defaultOpen={defaultOpen} onOpenChange={handleOpenChange}>
      <LayoutContent />
    </SidebarProvider>
  );
}
```

Update `apps/web/src/components/layout/index.ts`:

```typescript
export { AppLayout } from "./AppLayout";
export { AppSidebar } from "./AppSidebar";
export { UserMenu } from "./UserMenu";
export { Breadcrumbs } from "./Breadcrumbs";
export { ProtectedRoute } from "./ProtectedRoute";
export { MobileNav } from "./MobileNav";
```
  </action>
  <verify>
```bash
cd apps/web && pnpm tsc --noEmit
```
No errors. Resize browser to mobile width (<768px) - bottom tab bar should appear.
  </verify>
  <done>Mobile bottom tab bar implemented, shows on screens < 768px</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete navigation system</name>
  <what-built>
Complete navigation infrastructure including:
- Collapsible sidebar (VS Code-style icon rail)
- Role-based navigation filtering
- User menu with avatar, profile, logout
- Breadcrumbs with slash separators
- Protected admin routes
- Role-based home redirects
- Mobile bottom tab bar
  </what-built>
  <how-to-verify>
1. Start dev server: `cd apps/web && pnpm dev`
2. Open http://localhost:5173 in browser

**Desktop (> 768px):**
- [ ] Sidebar visible with logo, nav items, user menu
- [ ] Click sidebar toggle (or Cmd/Ctrl+B) - collapses to icon rail
- [ ] Hover over collapsed sidebar - expands as overlay
- [ ] Active nav item has left purple border + bold text
- [ ] Breadcrumbs show in header (e.g., "Home / Projects / New")
- [ ] All breadcrumb segments clickable
- [ ] User menu shows avatar (or initials), dropdown has Profile + Logout
- [ ] If admin: "Users" nav item visible; if not admin: hidden

**Role-based home (requires different user roles):**
- [ ] Admin user at "/" sees dashboard
- [ ] Team lead at "/" redirects to /teams
- [ ] Annotator at "/" redirects to /projects

**Protected routes:**
- [ ] Non-admin accessing /admin/users redirects to /

**Mobile (< 768px):**
- [ ] Resize browser to mobile width
- [ ] Sidebar hidden, bottom tab bar appears
- [ ] Tab bar has: Home, Projects, Teams, Tasks, Profile
- [ ] Active tab highlighted with primary color
- [ ] Content has bottom padding to avoid tab bar overlap
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] Mobile bottom tab bar appears on screens < 768px
- [ ] Content area has padding to avoid tab bar overlap
- [ ] All navigation features verified by human
</verification>

<success_criteria>
- Mobile navigation provides quick access to primary features
- All Phase 4.1 requirements verified by human tester
- Navigation system production-ready
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-ux-navigation-flow/04.1-06-SUMMARY.md`
</output>
