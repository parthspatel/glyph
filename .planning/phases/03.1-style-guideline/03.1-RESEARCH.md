# Phase 3.1: Style Guideline - Research

**Researched:** 2026-01-31
**Domain:** Design System / CSS Architecture / Theming
**Confidence:** HIGH

## Summary

This phase establishes a comprehensive design system for Glyph using Tailwind CSS v4 with shadcn/ui components, featuring dark/light mode support with royal purple as the primary brand color. The current codebase uses vanilla CSS with CSS custom properties (~900 lines in index.css), which will need migration to Tailwind utility classes.

The standard approach is to use Tailwind CSS v4's new Vite plugin for zero-config setup, shadcn/ui with Stone base theme (warm neutrals matching the user's preference), and custom CSS variables in OKLCH format for the purple primary color. Theme switching is handled via a custom ThemeProvider/useTheme hook pattern that respects system preference with localStorage persistence.

**Primary recommendation:** Install Tailwind v4 via `@tailwindcss/vite` plugin, initialize shadcn/ui with Stone base theme, customize primary color to purple (~#7C3AED range), and implement a custom ThemeProvider for theme management.

## Standard Stack

The established libraries/tools for this domain:

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| tailwindcss | ^4.0 | Utility-first CSS framework | v4 has first-party Vite plugin, OKLCH colors, 5x faster builds |
| @tailwindcss/vite | ^4.0 | Vite integration | Zero config, maximum performance |
| shadcn/ui | latest | Component library | Built on Radix, Tailwind-first, copy-paste components |
| class-variance-authority | ^0.7 | Component variants | Standard for shadcn component variants |
| clsx | ^2.1 | Class name utility | Conditional className merging |
| tailwind-merge | ^2.6 | Tailwind class merging | Resolves Tailwind class conflicts |
| lucide-react | ^0.469 | Icon library | shadcn default, already in project |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| @fontsource-variable/inter | latest | Inter font | Self-hosted variable font |
| tw-animate-css | latest | Animation utilities | Required by shadcn/ui |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| shadcn/ui | Radix UI directly | More control but more boilerplate |
| @fontsource/inter | Google Fonts CDN | Self-hosting preferred for privacy/performance |
| Custom ThemeProvider | next-themes | next-themes is for Next.js; custom is simpler for Vite |

**Installation:**
```bash
pnpm add tailwindcss @tailwindcss/vite class-variance-authority clsx tailwind-merge tw-animate-css @fontsource-variable/inter
pnpm add -D @types/node
```

## Architecture Patterns

### Recommended Project Structure
```
apps/web/src/
├── index.css                    # Tailwind import + CSS variables + theme tokens
├── lib/
│   └── utils.ts                 # cn() utility function
├── components/
│   ├── ui/                      # shadcn/ui components (Button, Card, etc.)
│   └── theme-provider.tsx       # Theme context and provider
├── hooks/
│   └── useTheme.ts              # Theme state hook (if separate from provider)
└── styles/
    └── design-tokens.css        # Optional: separate token definitions
```

### Pattern 1: CSS Variables for Theming (OKLCH Format)
**What:** Define all theme colors as CSS custom properties using OKLCH color space
**When to use:** Always - this is the shadcn/ui v4 standard
**Example:**
```css
/* Source: https://ui.shadcn.com/docs/theming */
@import "tailwindcss";

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  /* ... other semantic colors */
}

:root {
  --background: oklch(0.99 0.002 106.423);      /* Stone 50 */
  --foreground: oklch(0.216 0.006 56.043);     /* Stone 950 */
  --primary: oklch(0.627 0.265 303.9);         /* Purple 500 */
  --primary-foreground: oklch(0.977 0.014 308.299); /* Purple 50 */
  /* ... */
}

.dark {
  --background: oklch(0 0 0);                   /* Pure black */
  --foreground: oklch(0.97 0.001 106.424);     /* Stone 50 */
  --primary: oklch(0.627 0.265 303.9);         /* Purple 500 (unchanged) */
  --primary-foreground: oklch(0.977 0.014 308.299);
  /* ... */
}
```

### Pattern 2: ThemeProvider for Vite Apps
**What:** React context for theme state management with localStorage persistence
**When to use:** For any Vite/React app needing theme switching
**Example:**
```typescript
// Source: https://ui.shadcn.com/docs/dark-mode/vite
import { createContext, useContext, useEffect, useState } from "react";

type Theme = "dark" | "light" | "system";

type ThemeProviderProps = {
  children: React.ReactNode;
  defaultTheme?: Theme;
  storageKey?: string;
};

type ThemeProviderState = {
  theme: Theme;
  setTheme: (theme: Theme) => void;
};

const ThemeProviderContext = createContext<ThemeProviderState | undefined>(undefined);

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "glyph-ui-theme",
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(
    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
  );

  useEffect(() => {
    const root = window.document.documentElement;
    root.classList.remove("light", "dark");

    if (theme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
      root.classList.add(systemTheme);
      return;
    }

    root.classList.add(theme);
  }, [theme]);

  const value = {
    theme,
    setTheme: (theme: Theme) => {
      localStorage.setItem(storageKey, theme);
      setTheme(theme);
    },
  };

  return (
    <ThemeProviderContext.Provider value={value}>
      {children}
    </ThemeProviderContext.Provider>
  );
}

export const useTheme = () => {
  const context = useContext(ThemeProviderContext);
  if (!context) throw new Error("useTheme must be used within a ThemeProvider");
  return context;
};
```

### Pattern 3: cn() Utility Function
**What:** Combines clsx and tailwind-merge for conditional class names
**When to use:** Every component that uses Tailwind classes
**Example:**
```typescript
// Source: https://ui.shadcn.com/docs/installation/manual
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

// Usage
<button className={cn(
  "px-4 py-2 rounded-md",
  variant === "primary" && "bg-primary text-primary-foreground",
  disabled && "opacity-50 cursor-not-allowed"
)} />
```

### Anti-Patterns to Avoid
- **Mixing vanilla CSS and Tailwind:** Choose one approach; don't have `.btn` classes alongside Tailwind utilities
- **Hardcoding colors:** Never use hex values directly; always use CSS variables or Tailwind classes
- **Using `@apply` extensively:** Tailwind recommends component extraction over heavy `@apply` usage
- **Dark mode via separate stylesheets:** Use the `.dark` class toggle, not separate CSS files

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Class name merging | Custom string concat | `cn()` with tailwind-merge | Handles Tailwind class conflicts properly |
| Theme persistence | Custom localStorage logic | ThemeProvider pattern | Handles system preference, hydration, persistence |
| Button variants | Custom CSS for each variant | class-variance-authority (cva) | Type-safe variants with Tailwind |
| Focus ring styling | Manual focus CSS | Tailwind `focus-visible:ring` | Accessibility built-in |
| Dark mode toggle | Custom state management | ThemeProvider + useTheme | Standard pattern, handles system preference |
| Component library | Build from scratch | shadcn/ui components | Accessibility, keyboard navigation, variants |

**Key insight:** shadcn/ui is "copy-paste" components - you own the code but get battle-tested patterns for free. The components are not a dependency; they're copied into your codebase.

## Common Pitfalls

### Pitfall 1: Forgetting the @theme inline Directive
**What goes wrong:** CSS variables defined in :root don't work with Tailwind classes like `bg-primary`
**Why it happens:** Tailwind v4 requires explicit mapping of CSS variables to Tailwind's theme
**How to avoid:** Always include `@theme inline` block mapping `--color-*` to CSS variables
**Warning signs:** `bg-primary` shows no color, browser devtools show `--tw-*` variables undefined

### Pitfall 2: Flash of Wrong Theme (FOWT)
**What goes wrong:** Brief flash of light mode before dark mode applies
**Why it happens:** JavaScript-based theme detection runs after initial render
**How to avoid:** Add inline script in `<head>` before React mounts to set `.dark` class immediately
**Warning signs:** Visible flash when loading page in dark mode

### Pitfall 3: Stone Theme Confusion
**What goes wrong:** Mixing Stone base colors with other neutral scales
**Why it happens:** Stone has warm undertones; mixing with Zinc/Slate creates visual inconsistency
**How to avoid:** Use Stone palette exclusively for neutrals; shadcn init with `baseColor: "stone"`
**Warning signs:** Some grays look "cold" while others look "warm"

### Pitfall 4: Tailwind v4 Config Mismatch
**What goes wrong:** Creating `tailwind.config.js` when using v4's new approach
**Why it happens:** Outdated tutorials show v3 patterns
**How to avoid:** With `@tailwindcss/vite` plugin, configuration is in CSS file via `@theme`, not JS
**Warning signs:** Custom colors not working, config file changes having no effect

### Pitfall 5: Radix UI CSS Specificity
**What goes wrong:** shadcn component styles don't apply or are overridden
**Why it happens:** Existing vanilla CSS has higher specificity
**How to avoid:** Remove all vanilla CSS that targets elements shadcn components use
**Warning signs:** Buttons look wrong, modals styled incorrectly

### Pitfall 6: OKLCH Browser Support
**What goes wrong:** Colors don't display on older browsers
**Why it happens:** OKLCH is modern CSS, older browsers don't support it
**How to avoid:** Include fallback hex/rgb values or ensure target browsers support OKLCH
**Warning signs:** Colors missing in Safari 15, older Chrome versions

## Code Examples

Verified patterns from official sources:

### components.json Configuration
```json
// Source: https://ui.shadcn.com/docs/components-json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/index.css",
    "baseColor": "stone",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
```

### vite.config.ts with Tailwind v4
```typescript
// Source: https://ui.shadcn.com/docs/installation/vite
import path from "path";
import tailwindcss from "@tailwindcss/vite";
import react from "@vitejs/plugin-react";
import { defineConfig } from "vite";

export default defineConfig({
  plugins: [react(), tailwindcss()],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  server: {
    port: 5173,
    proxy: {
      "/api": {
        target: "http://localhost:3000",
        changeOrigin: true,
      },
    },
  },
});
```

### index.css with Design Tokens
```css
/* Source: https://ui.shadcn.com/docs/theming + custom purple primary */
@import "tailwindcss";
@import "@fontsource-variable/inter";

@theme inline {
  --font-sans: "Inter Variable", ui-sans-serif, system-ui, sans-serif;
  --radius-sm: 0.25rem;
  --radius-md: 0.375rem;
  --radius-lg: 0.5rem;
  
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
}

/* Light mode - Stone base with purple primary */
:root {
  --background: oklch(0.99 0.002 106.423);
  --foreground: oklch(0.216 0.006 56.043);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.216 0.006 56.043);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.216 0.006 56.043);
  --primary: oklch(0.627 0.265 303.9);
  --primary-foreground: oklch(0.977 0.014 308.299);
  --secondary: oklch(0.95 0.004 106.589);
  --secondary-foreground: oklch(0.216 0.006 56.043);
  --muted: oklch(0.95 0.004 106.589);
  --muted-foreground: oklch(0.553 0.013 58.071);
  --accent: oklch(0.95 0.004 106.589);
  --accent-foreground: oklch(0.216 0.006 56.043);
  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.977 0.014 308.299);
  --border: oklch(0.902 0.006 106.589);
  --input: oklch(0.902 0.006 106.589);
  --ring: oklch(0.714 0.203 305.504);
  --radius: 0.375rem;
}

/* Dark mode - Pure black surfaces with purple primary */
.dark {
  --background: oklch(0 0 0);
  --foreground: oklch(0.97 0.001 106.424);
  --card: oklch(0.1 0.002 106.423);
  --card-foreground: oklch(0.97 0.001 106.424);
  --popover: oklch(0.1 0.002 106.423);
  --popover-foreground: oklch(0.97 0.001 106.424);
  --primary: oklch(0.627 0.265 303.9);
  --primary-foreground: oklch(0.977 0.014 308.299);
  --secondary: oklch(0.268 0.007 34.298);
  --secondary-foreground: oklch(0.97 0.001 106.424);
  --muted: oklch(0.268 0.007 34.298);
  --muted-foreground: oklch(0.709 0.01 106.423);
  --accent: oklch(0.268 0.007 34.298);
  --accent-foreground: oklch(0.97 0.001 106.424);
  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.977 0.014 308.299);
  --border: oklch(0.268 0.007 34.298);
  --input: oklch(0.268 0.007 34.298);
  --ring: oklch(0.714 0.203 305.504);
}

body {
  font-family: var(--font-sans);
  background-color: var(--color-background);
  color: var(--color-foreground);
}
```

### Inter Font Import
```typescript
// Source: https://fontsource.org/fonts/inter/install
// In main.tsx or App.tsx
import "@fontsource-variable/inter";
```

### FOWT Prevention Script
```html
<!-- Source: Community best practice for Vite apps -->
<!-- Add to index.html <head> before main script -->
<script>
  (function() {
    const theme = localStorage.getItem('glyph-ui-theme') || 'system';
    const isDark = theme === 'dark' || 
      (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);
    if (isDark) document.documentElement.classList.add('dark');
  })();
</script>
```

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| tailwind.config.js | @theme in CSS | Tailwind v4 (2025) | No config file needed |
| HSL color format | OKLCH color format | Tailwind v4 | Better perceptual uniformity |
| PostCSS config required | @tailwindcss/vite plugin | Tailwind v4 | Zero config for Vite |
| shadcn "default" style | shadcn "new-york" style | shadcn 2024 | "default" deprecated |
| next-themes for all React | next-themes for Next.js only | Always | Use custom ThemeProvider for Vite |

**Deprecated/outdated:**
- `tailwind.config.js` for Tailwind v4 with Vite plugin - use CSS-based config
- shadcn "default" style - use "new-york" instead
- HSL format in CSS variables - OKLCH is the new standard

## Open Questions

Things that couldn't be fully resolved:

1. **Exact OKLCH values for royal purple #7C3AED**
   - What we know: Tailwind purple-500 (`oklch(0.627 0.265 303.9)`) is close
   - What's unclear: Whether #7C3AED converts to exactly purple-500 or needs adjustment
   - Recommendation: Use purple-500 as starting point; fine-tune if needed

2. **Migration strategy for ~900 lines of vanilla CSS**
   - What we know: Current CSS uses semantic class names (.btn, .card, .table-row)
   - What's unclear: Whether to migrate incrementally or all-at-once
   - Recommendation: Plan incrementally - theme first, then components one at a time

3. **Theme preference sync to user profile**
   - What we know: CONTEXT.md mentions syncing to profile when logged in
   - What's unclear: API endpoint design, when to sync
   - Recommendation: Defer to future phase; localStorage-only for now

## Sources

### Primary (HIGH confidence)
- [shadcn/ui Vite Installation](https://ui.shadcn.com/docs/installation/vite) - Complete setup guide
- [shadcn/ui Theming](https://ui.shadcn.com/docs/theming) - CSS variables and OKLCH format
- [shadcn/ui Dark Mode Vite](https://ui.shadcn.com/docs/dark-mode/vite) - ThemeProvider pattern
- [shadcn/ui components.json](https://ui.shadcn.com/docs/components-json) - Configuration options
- [Tailwind CSS Colors](https://tailwindcss.com/docs/colors) - Purple/Violet OKLCH values

### Secondary (MEDIUM confidence)
- [Fontsource Inter](https://fontsource.org/fonts/inter/install) - Font loading pattern
- [Tailwind CSS v4 Blog](https://tailwindcss.com/blog/tailwindcss-v4) - v4 feature overview

### Tertiary (LOW confidence)
- Various DEV.to and Medium articles on dark mode patterns - validated against official docs

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - All verified via official shadcn/ui and Tailwind docs
- Architecture: HIGH - Official installation guides with specific Vite instructions
- Pitfalls: MEDIUM - Mix of official docs and community experience
- Theme implementation: HIGH - Official shadcn/ui dark mode Vite documentation

**Research date:** 2026-01-31
**Valid until:** 2026-03-31 (60 days - Tailwind v4 is stable, shadcn patterns established)
