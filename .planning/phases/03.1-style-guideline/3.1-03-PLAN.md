---
phase: 3.1-style-guideline
plan: 03
type: execute
wave: 3
depends_on: ["3.1-02"]
files_modified:
  - apps/web/components.json
  - apps/web/src/main.tsx
autonomous: false

must_haves:
  truths:
    - "shadcn/ui configured with Stone base theme and purple primary"
    - "ThemeProvider wraps the application"
    - "Theme switches automatically based on system preference"
    - "Theme preference persists across page refresh"
  artifacts:
    - path: "apps/web/components.json"
      provides: "shadcn/ui configuration"
      contains: "baseColor"
    - path: "apps/web/src/main.tsx"
      provides: "ThemeProvider integration"
      contains: "ThemeProvider"
  key_links:
    - from: "apps/web/src/main.tsx"
      to: "apps/web/src/components/theme-provider.tsx"
      via: "import and wrapping"
      pattern: "ThemeProvider"
---

<objective>
Initialize shadcn/ui and integrate ThemeProvider into the application

Purpose: Complete the design system setup and verify theme switching works
Output: Fully configured design system with working theme switching
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.1-style-guideline/03.1-CONTEXT.md
@.planning/phases/03.1-style-guideline/03.1-RESEARCH.md
@.planning/phases/03.1-style-guideline/3.1-01-SUMMARY.md
@.planning/phases/03.1-style-guideline/3.1-02-SUMMARY.md
@apps/web/src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shadcn/ui components.json configuration</name>
  <files>apps/web/components.json</files>
  <action>
Create apps/web/components.json with shadcn/ui configuration:

```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/index.css",
    "baseColor": "stone",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}
```

Key configuration choices:
- style: "new-york" (recommended over deprecated "default")
- rsc: false (not using React Server Components)
- baseColor: "stone" (warm neutrals per CONTEXT.md)
- cssVariables: true (using CSS custom properties)
- config: "" (empty - Tailwind v4 doesn't use tailwind.config.js)
- aliases: Match the @ path alias configured in vite/tsconfig
  </action>
  <verify>`cat apps/web/components.json | grep -E "\"style\"|\"baseColor\""` shows new-york and stone</verify>
  <done>components.json exists with Stone base, new-york style, and correct aliases</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ThemeProvider into main.tsx</name>
  <files>apps/web/src/main.tsx</files>
  <action>
Update apps/web/src/main.tsx to wrap the app with ThemeProvider:

```typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { BrowserRouter } from 'react-router-dom';
import { ThemeProvider } from '@/components/theme-provider';
import { App } from './App';
import './index.css';

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60, // 1 minute
      retry: 1,
    },
  },
});

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <ThemeProvider defaultTheme="system" storageKey="glyph-ui-theme">
      <QueryClientProvider client={queryClient}>
        <BrowserRouter>
          <App />
        </BrowserRouter>
      </QueryClientProvider>
    </ThemeProvider>
  </React.StrictMode>
);
```

Changes:
1. Import ThemeProvider from '@/components/theme-provider'
2. Wrap all providers with ThemeProvider (outermost so theme available everywhere)
3. Set defaultTheme="system" to respect OS preference
4. Use storageKey="glyph-ui-theme" matching FOWT script and ThemeProvider
  </action>
  <verify>`cat apps/web/src/main.tsx | grep -E "ThemeProvider|defaultTheme"` shows ThemeProvider import and usage</verify>
  <done>main.tsx wraps app with ThemeProvider using system default and glyph-ui-theme storage key</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete design system with Tailwind v4, OKLCH design tokens, ThemeProvider, and theme switching infrastructure. The application should now:
- Automatically detect system theme preference
- Apply purple primary color (#7C3AED range)
- Use warm Stone neutrals
- Switch between light and dark modes
  </what-built>
  <how-to-verify>
1. Start the dev server: `cd apps/web && pnpm dev`
2. Open http://localhost:5173 in browser
3. Verify initial theme matches your OS setting
4. Open browser DevTools and toggle system theme preference:
   - Chrome: DevTools -> Rendering -> Emulate CSS media feature prefers-color-scheme
   - Set to "dark" - page should switch to dark mode (black background)
   - Set to "light" - page should switch to light mode (white/light background)
5. Test localStorage persistence:
   - Open DevTools -> Application -> Local Storage -> localhost:5173
   - Note the current "glyph-ui-theme" value
   - Manually change it to "dark" or "light" and refresh - theme should apply
6. Verify no flash of wrong theme:
   - Set localStorage to "dark"
   - Hard refresh (Cmd+Shift+R / Ctrl+Shift+R)
   - Page should load directly in dark mode with no flash

Note: Existing components may look broken because we replaced the vanilla CSS. This is expected - styling components is Phase 4.2.
  </how-to-verify>
  <resume-signal>Type "approved" if theme switching works correctly, or describe any issues observed</resume-signal>
</task>

</tasks>

<verification>
1. components.json exists with correct shadcn/ui configuration
2. main.tsx imports and uses ThemeProvider
3. Dev server starts without errors
4. Theme switches automatically with system preference
5. Theme persists across page refresh
6. No flash of wrong theme on load
</verification>

<success_criteria>
- shadcn/ui components.json configured with Stone base and new-york style
- ThemeProvider integrated as outermost provider in main.tsx
- Theme automatically respects system preference
- Manual theme changes persist in localStorage
- No flash of wrong theme on page load
</success_criteria>
