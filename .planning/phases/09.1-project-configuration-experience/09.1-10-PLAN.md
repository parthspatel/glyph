---
phase: 09.1-project-configuration-experience
plan: 10
type: execute
wave: 5
depends_on: ["09.1-09"]
files_modified:
  - apps/web/src/components/workflow/Testing/WorkflowTester.tsx
  - apps/web/src/components/workflow/Testing/TestDataSelector.tsx
  - apps/web/src/components/workflow/Testing/StepExecutor.tsx
  - apps/web/src/components/workflow/Testing/TestResultsPanel.tsx
  - apps/web/src/components/workflow/hooks/useWorkflowTest.ts
autonomous: true

must_haves:
  truths:
    - "User can start test from Test button or right-click"
    - "Test runs with transient data (not saved)"
    - "Current step highlights on canvas"
  artifacts:
    - path: "apps/web/src/components/workflow/Testing/WorkflowTester.tsx"
      provides: "Test execution container"
      exports: ["WorkflowTester"]
    - path: "apps/web/src/components/workflow/hooks/useWorkflowTest.ts"
      provides: "Test execution state"
      exports: ["useWorkflowTest"]
  key_links:
    - from: "WorkflowTester.tsx"
      to: "canvasStore.ts"
      via: "highlights current step"
      pattern: "setHighlightedNode"
---

<objective>
Create workflow testing mode for transient execution without saving results.

Purpose: Per CONTEXT.md, users can test workflows with real or synthetic data. Test results are ephemeral (disappear when session ends). The canvas shows current step highlighted during execution.

Output: Full test mode UI with data selection, step-through execution, and results display.
</objective>

<execution_context>
@/Users/parthpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/parthpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09.1-project-configuration-experience/09.1-CONTEXT.md
@.planning/phases/09.1-project-configuration-experience/09.1-09-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useWorkflowTest hook and TestDataSelector</name>
  <files>
apps/web/src/components/workflow/hooks/useWorkflowTest.ts
apps/web/src/components/workflow/Testing/TestDataSelector.tsx
  </files>
  <action>
Create useWorkflowTest.ts hook:
- State: testMode (boolean), currentStepId, stepResults (Map), testData, errors
- Actions: startTest, stopTest, advanceStep, setStepResult, reset
- Test flow:
  1. User selects data
  2. Start from Start node
  3. Execute each step (user provides annotation or auto-fill)
  4. Advance based on transitions
  5. End when reaching End node
- Track execution path for visualization
- Results are in-memory only (ephemeral)

Create TestDataSelector.tsx (per CONTEXT.md):
- Three data source options:
  1. "From Data Source" - pick row from configured data source
  2. "Custom JSON" - paste/edit JSON manually
  3. "Generate Synthetic" - create fake data based on schema
- Validate selected data against input schema
- Show validation errors if data doesn't match
- "Use this data" button to confirm selection

For synthetic generation:
- Use faker.js or similar: `pnpm add @faker-js/faker`
- Generate values based on JSON Schema types
- Handle nested objects and arrays
  </action>
  <verify>Select test data, validation passes for valid data</verify>
  <done>Test hook manages state, data selector provides options</done>
</task>

<task type="auto">
  <name>Task 2: Create StepExecutor and TestResultsPanel</name>
  <files>
apps/web/src/components/workflow/Testing/StepExecutor.tsx
apps/web/src/components/workflow/Testing/TestResultsPanel.tsx
  </files>
  <action>
Create StepExecutor.tsx:
- Renders embedded layout preview for current step
- For annotation steps: show layout in iframe/sandbox
- For review steps: show side-by-side with prior annotation
- Controls:
  - "Submit" - saves result and advances
  - "Skip" - skip to next step
  - "Pause" - pause automatic execution
- Quick fill feature (per CONTEXT.md):
  - If step needs multiple annotators
  - "Auto-fill variations" button generates slight variations

Create TestResultsPanel.tsx (per CONTEXT.md "Split view"):
- Right panel showing results
- Before/After tabs for each completed step
- JSON view of step input and output
- Diff highlighting (green: added, red: removed)
- Timeline view of execution path
- Error details if step failed

Add transformation trace:
- Expand to see Nunjucks evaluation steps
- Show intermediate values
  </action>
  <verify>Execute annotation step - result appears in panel</verify>
  <done>Step executor and results panel functional</done>
</task>

<task type="auto">
  <name>Task 3: Create WorkflowTester container and canvas integration</name>
  <files>
apps/web/src/components/workflow/Testing/WorkflowTester.tsx
apps/web/src/components/workflow/Testing/index.ts
apps/web/src/components/workflow/Canvas/WorkflowCanvas.tsx
apps/web/src/components/workflow/WorkflowDesigner.tsx
  </files>
  <action>
Create WorkflowTester.tsx:
- Full-screen modal or panel overlay
- Header: "--- TEST MODE ---" banner (per CONTEXT.md)
- Layout: Canvas (left) | Results (right) split view
- Entry points:
  - "Test Workflow" button in toolbar
  - Right-click node -> "Test from here"
  - Dedicated "Test" tab
- Flow:
  1. Show TestDataSelector
  2. On confirm, start test
  3. Show StepExecutor for each step
  4. Show TestResultsPanel with results
  5. On complete, show summary

Update WorkflowCanvas.tsx:
- Add highlightedNodeId state
- When in test mode, highlight current step:
  - Pulsing border animation
  - Different background color
- Show execution path on edges (animated dashes)

Update WorkflowDesigner.tsx:
- Add "Test" tab alongside Visual/YAML/Data Source
- Test tab shows WorkflowTester

Add right-click context menu on nodes:
- "Test from here" option
- Starts test at selected node (skips prior steps)

Create index.ts barrel export.
  </action>
  <verify>Click "Test Workflow", complete steps, see results</verify>
  <done>Full test mode integrated with canvas highlighting</done>
</task>

</tasks>

<verification>
1. Click "Test Workflow" - data selector appears
2. Select data, start test - first step shows
3. Complete annotation - advances to next step
4. Canvas shows current step highlighted
5. Complete workflow - see results summary
6. Close test mode - results disappear (ephemeral)
</verification>

<success_criteria>
- Three data selection modes (source, custom, synthetic)
- Step-through execution with embedded layout
- Current step highlighted on canvas
- Results panel shows before/after JSON
- Results are ephemeral (not saved)
- "Test from here" via right-click
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-project-configuration-experience/09.1-10-SUMMARY.md`
</output>
