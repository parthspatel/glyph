---
phase: 09.1-project-configuration-experience
plan: 12
type: execute
wave: 6
depends_on: ["09.1-03", "09.1-05", "09.1-07", "09.1-09", "09.1-10", "09.1-11"]
files_modified:
  - apps/web/src/pages/WorkflowDesignerPage.tsx
  - apps/web/src/routes.tsx
autonomous: false

must_haves:
  truths:
    - "Workflow designer page loads with all tabs"
    - "Visual editing, YAML editing, data source, testing all work"
    - "User can design, test, and activate workflow end-to-end"
  artifacts:
    - path: "apps/web/src/pages/WorkflowDesignerPage.tsx"
      provides: "Workflow designer page"
      exports: ["WorkflowDesignerPage"]
  key_links:
    - from: "WorkflowDesignerPage.tsx"
      to: "WorkflowDesigner.tsx"
      via: "renders designer"
      pattern: "WorkflowDesigner"
---

<objective>
Create the workflow designer page, integrate all components, and verify end-to-end functionality.

Purpose: Final integration plan bringing together all workflow designer features into a cohesive page with proper routing and state management.

Output: Complete workflow designer page accessible via route, verified working end-to-end.
</objective>

<execution_context>
@/Users/parthpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/parthpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09.1-project-configuration-experience/09.1-CONTEXT.md
@.planning/phases/09.1-project-configuration-experience/09.1-03-SUMMARY.md
@.planning/phases/09.1-project-configuration-experience/09.1-05-SUMMARY.md
@.planning/phases/09.1-project-configuration-experience/09.1-07-SUMMARY.md
@.planning/phases/09.1-project-configuration-experience/09.1-09-SUMMARY.md
@.planning/phases/09.1-project-configuration-experience/09.1-10-SUMMARY.md
@.planning/phases/09.1-project-configuration-experience/09.1-11-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WorkflowDesignerPage and route</name>
  <files>
apps/web/src/pages/WorkflowDesignerPage.tsx
apps/web/src/routes.tsx
  </files>
  <action>
Create WorkflowDesignerPage.tsx:
- Wrapper page component for workflow designer
- Load project data from URL params (projectId)
- Load existing workflow if project has one
- Initialize stores with loaded data
- Handle save/load lifecycle:
  - Auto-save draft every 30 seconds
  - Save on explicit "Save" button
  - Warn on navigation if unsaved changes
- Page layout:
  - Header with project name, save status, action buttons
  - Full-height WorkflowDesigner component
  - Footer with save status indicator

Update routes.tsx:
- Add route: /projects/:projectId/workflow
- Protected route (requires auth)
- Breadcrumb: Projects > {Project Name} > Workflow Designer

Handle URL states:
- /projects/:id/workflow - visual tab
- /projects/:id/workflow?tab=yaml - yaml tab
- /projects/:id/workflow?tab=data - data source tab
- /projects/:id/workflow?tab=test - test tab
  </action>
  <verify>Navigate to /projects/{id}/workflow - page loads with designer</verify>
  <done>Workflow designer page created with route</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end verification of workflow designer</name>
  <what-built>
Complete workflow designer with:
- Visual canvas (drag-drop nodes, connect edges)
- Step configuration panel (layout, consensus, assignment)
- YAML editor with bidirectional sync
- Data source configuration (wizard + schema editor)
- Data flow mapping (Nunjucks editor + preview)
- Validation with problems panel
- Test mode (step-through execution)
- Activation checklist
  </what-built>
  <how-to-verify>
1. Navigate to http://localhost:3000 and login
2. Go to an existing project or create new project
3. Click "Configure Workflow" or navigate to /projects/{id}/workflow

Test Visual Editor:
4. Drag "Start" node from palette to canvas
5. Drag "Annotation" node, connect to Start
6. Drag "End" node, connect to Annotation
7. Click Annotation node - config panel opens
8. Assign a layout from dropdown
9. Verify red badge disappears after configuring

Test YAML Editor:
10. Switch to YAML tab
11. Verify workflow appears as YAML
12. Edit step name in YAML
13. Switch to Visual - verify name updated on node

Test Data Source:
14. Switch to Data Source tab
15. If no data source, complete wizard
16. Edit schema in Monaco editor
17. Preview data rows with prev/next

Test Data Flow:
18. Select annotation step
19. Open Data Flow section
20. Type {{ input. and verify autocomplete shows fields
21. Check live preview updates

Test Validation:
22. Delete edge between nodes
23. Verify red badge appears on disconnected node
24. Verify problems panel shows "Unreachable node" error
25. Click error - canvas navigates to node

Test Mode:
26. Click "Test Workflow"
27. Select test data (custom JSON or from source)
28. Complete annotation in embedded layout
29. Verify result appears in results panel
30. Verify canvas highlights current step

Activation:
31. Click "Activate Project"
32. Verify checklist shows validation status
33. Fix any blockers
34. Click Activate, confirm
35. Verify success modal with next steps

Expected: All features work, professional polish, no obvious bugs
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
Full end-to-end test covering:
- Visual canvas editing
- YAML editing with sync
- Data source configuration
- Data flow mapping
- Validation and error display
- Test mode execution
- Project activation
</verification>

<success_criteria>
- All tabs accessible and functional
- Visual/YAML sync works bidirectionally
- Validation catches errors, shows in panel
- Test mode runs through workflow
- Activation checklist validates and activates
- No console errors, professional appearance
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-project-configuration-experience/09.1-12-SUMMARY.md`
</output>
