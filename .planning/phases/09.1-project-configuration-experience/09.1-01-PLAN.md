---
phase: 09.1-project-configuration-experience
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/src/components/workflow/stores/canvasStore.ts
  - apps/web/src/components/workflow/stores/configStore.ts
  - apps/web/src/components/workflow/Canvas/WorkflowCanvas.tsx
  - apps/web/src/components/workflow/types.ts
autonomous: true

must_haves:
  truths:
    - "React Flow renders on workflow designer page"
    - "Canvas state persists in Zustand store"
    - "Viewport controls (zoom, pan) work"
  artifacts:
    - path: "apps/web/src/components/workflow/stores/canvasStore.ts"
      provides: "Canvas state management"
      exports: ["useCanvasStore"]
    - path: "apps/web/src/components/workflow/stores/configStore.ts"
      provides: "Step configuration state"
      exports: ["useConfigStore"]
    - path: "apps/web/src/components/workflow/Canvas/WorkflowCanvas.tsx"
      provides: "React Flow wrapper"
      exports: ["WorkflowCanvas"]
  key_links:
    - from: "WorkflowCanvas.tsx"
      to: "canvasStore.ts"
      via: "useCanvasStore hook"
      pattern: "useCanvasStore"
---

<objective>
Set up React Flow infrastructure with Zustand state management for the workflow designer canvas.

Purpose: Foundation for all visual workflow editing. React Flow provides node-based canvas; Zustand provides independent state management aligned with React Flow's internal architecture.

Output: Working canvas component with state stores, ready for custom nodes.
</objective>

<execution_context>
@/Users/parthpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/parthpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09.1-project-configuration-experience/09.1-CONTEXT.md
@.planning/phases/09.1-project-configuration-experience/09.1-RESEARCH.md
@apps/web/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install React Flow and js-yaml dependencies</name>
  <files>apps/web/package.json</files>
  <action>
Install @xyflow/react (React Flow 12.x) and js-yaml:

```bash
cd apps/web && pnpm add @xyflow/react js-yaml && pnpm add -D @types/js-yaml
```

React Flow 12.x has TypeScript support, accessibility, and performance optimizations.
js-yaml for YAML parsing/serialization in dual-editor feature.
  </action>
  <verify>`grep "@xyflow/react" apps/web/package.json` shows dependency</verify>
  <done>Dependencies installed in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create Zustand stores for canvas and config state</name>
  <files>
apps/web/src/components/workflow/stores/canvasStore.ts
apps/web/src/components/workflow/stores/configStore.ts
apps/web/src/components/workflow/types.ts
  </files>
  <action>
Create workflow types file (types.ts) with TypeScript interfaces:
- WorkflowNode (extends React Flow Node with stepType, stepConfig)
- WorkflowEdge (extends React Flow Edge with condition data)
- StepType enum (start, end, annotation, review, adjudication, auto_process, condition, fork, join, sub_workflow)
- StepConfig interface matching backend WorkflowConfig step structure
- TransitionConfig interface matching backend transition structure

Create canvasStore.ts with Zustand:
- State: nodes, edges, viewport, selectedNodeId, selectedEdgeIds
- Actions: setNodes, setEdges, onNodesChange, onEdgesChange, setViewport, selectNode
- Undo/redo stack for canvas operations
- Use immer middleware for immutable updates
- Persist to sessionStorage for crash recovery

Create configStore.ts with Zustand:
- State: stepConfigs (Record<nodeId, StepConfig>), workflowMeta (name, version, type), dirty flag
- Actions: updateStepConfig, setWorkflowMeta, markClean, markDirty
- Separate undo/redo stack for config changes
- Persist to sessionStorage
  </action>
  <verify>TypeScript compiles without errors. Stores export expected hooks.</verify>
  <done>Both stores functional with undo/redo and persistence</done>
</task>

<task type="auto">
  <name>Task 3: Create WorkflowCanvas component with React Flow</name>
  <files>
apps/web/src/components/workflow/Canvas/WorkflowCanvas.tsx
apps/web/src/components/workflow/index.ts
  </files>
  <action>
Create WorkflowCanvas.tsx as React Flow wrapper:

1. Import ReactFlow, Controls, MiniMap, Background from @xyflow/react
2. Import '@xyflow/react/dist/style.css'
3. Use canvasStore for state (nodes, edges, onNodesChange, onEdgesChange)
4. Configure ReactFlow:
   - fitView on mount
   - snapToGrid: true, snapGrid: [15, 15]
   - panOnScroll, zoomOnScroll, panOnDrag
   - selectionOnDrag for marquee selection
   - multiSelectionKeyCode: "Shift"
   - deleteKeyCode: ["Backspace", "Delete"]
5. Add Controls in bottom-left (zoom in/out, fit view, lock)
6. Add MiniMap in bottom-right corner
7. Add Background with dots pattern (gap: 15)
8. Implement keyboard shortcuts using react-hotkeys-hook:
   - Ctrl+Z: undo (canvasStore.undo)
   - Ctrl+Y / Ctrl+Shift+Z: redo
9. Memoize component with React.memo

Create index.ts barrel export.
  </action>
  <verify>Component renders, shows grid/controls/minimap, zoom/pan work</verify>
  <done>WorkflowCanvas renders with controls, minimap, zoom/pan functional</done>
</task>

</tasks>

<verification>
1. `cd apps/web && pnpm build` completes
2. `pnpm typecheck` passes
3. Canvas renders in browser with grid, minimap, controls
</verification>

<success_criteria>
- React Flow canvas renders with zoom/pan/fit-view
- Zustand stores manage canvas and config state independently
- Minimap visible in corner
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-project-configuration-experience/09.1-01-SUMMARY.md`
</output>
