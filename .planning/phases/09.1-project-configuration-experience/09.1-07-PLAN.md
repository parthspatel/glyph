---
phase: 09.1-project-configuration-experience
plan: 07
type: execute
wave: 4
depends_on: ["09.1-06"]
files_modified:
  - apps/web/src/components/workflow/DataSource/DataSourceWizard.tsx
  - apps/web/src/components/workflow/DataSource/DataSourceForm.tsx
  - apps/web/src/components/workflow/DataSource/SchemaEditor.tsx
  - apps/web/src/components/workflow/DataSource/DataPreview.tsx
autonomous: true

must_haves:
  truths:
    - "First-time users see step-by-step wizard"
    - "Returning users can edit via direct form"
    - "Schema editor uses Monaco with JSON Schema validation"
  artifacts:
    - path: "apps/web/src/components/workflow/DataSource/DataSourceWizard.tsx"
      provides: "Step-by-step data source setup"
      exports: ["DataSourceWizard"]
    - path: "apps/web/src/components/workflow/DataSource/SchemaEditor.tsx"
      provides: "Monaco JSON Schema editor"
      exports: ["SchemaEditor"]
  key_links:
    - from: "DataSourceWizard.tsx"
      to: "/api/v1/data-sources"
      via: "useMutation"
      pattern: "useMutation"
---

<objective>
Create data source configuration with wizard for first-time setup and direct form for edits.

Purpose: Per CONTEXT.md, data source setup should guide first-time users through a wizard while allowing quick edits via form. Includes schema editor with Monaco for input/output schemas.

Output: Complete data source configuration UI with wizard, form, schema editor, and data preview.
</objective>

<execution_context>
@/Users/parthpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/parthpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09.1-project-configuration-experience/09.1-CONTEXT.md
@.planning/phases/09.1-project-configuration-experience/09.1-06-SUMMARY.md
@apps/web/src/hooks/useDataSources.ts
@libs/domain/src/data_source.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DataSourceWizard for first-time setup</name>
  <files>
apps/web/src/components/workflow/DataSource/DataSourceWizard.tsx
apps/web/src/components/workflow/DataSource/WizardSteps/SourceTypeStep.tsx
apps/web/src/components/workflow/DataSource/WizardSteps/ConnectionStep.tsx
apps/web/src/components/workflow/DataSource/WizardSteps/SchemaStep.tsx
apps/web/src/components/workflow/DataSource/WizardSteps/ConfirmStep.tsx
  </files>
  <action>
Create DataSourceWizard.tsx as multi-step wizard:
- Step indicator showing progress (1-4)
- Back/Next navigation
- State management for wizard data

Step 1 - SourceTypeStep: 
- Card selection for source type: File Upload, S3, GCS, Azure Blob, API
- Each card shows icon, name, brief description

Step 2 - ConnectionStep:
- Dynamic form based on source type
- S3: bucket, region, access key (or IAM role), prefix
- GCS: bucket, credentials JSON
- API: endpoint URL, auth type, headers
- File Upload: drag-drop zone, file type filter
- "Test Connection" button that validates settings

Step 3 - SchemaStep:
- Input schema section (JSON Schema editor)
- Output schema section (JSON Schema editor)
- "Infer from file" button for uploaded files
- Preview inferred schema, allow manual adjustments

Step 4 - ConfirmStep:
- Summary of all settings
- Validation check results
- "Create Data Source" button

Use existing useDataSources hooks for mutations.
  </action>
  <verify>Complete wizard flow creates data source</verify>
  <done>4-step wizard guides user through data source setup</done>
</task>

<task type="auto">
  <name>Task 2: Create SchemaEditor with Monaco and DataPreview</name>
  <files>
apps/web/src/components/workflow/DataSource/SchemaEditor.tsx
apps/web/src/components/workflow/DataSource/DataPreview.tsx
  </files>
  <action>
Create SchemaEditor.tsx:
- Monaco editor configured for JSON
- JSON Schema validation enabled
- Pre-populate with JSON Schema draft-07 template
- Toolbar: Format, Copy, Clear
- Height: adjustable via resize handle
- Error markers for invalid JSON/schema
- Autocomplete for JSON Schema keywords

Create DataPreview.tsx (per CONTEXT.md "single row focus"):
- Show one data row at a time
- Prev/Next navigation buttons
- Row counter (e.g., "Row 3 of 150")
- JSON view with syntax highlighting
- Validate row against input schema, show errors
- "Jump to row" input
- Loading skeleton while fetching

Wire up to /api/v1/data-sources/{id}/preview endpoint.
  </action>
  <verify>Schema editor validates JSON Schema, data preview shows rows</verify>
  <done>Schema editor and data preview functional</done>
</task>

<task type="auto">
  <name>Task 3: Create DataSourceForm for editing and integrate</name>
  <files>
apps/web/src/components/workflow/DataSource/DataSourceForm.tsx
apps/web/src/components/workflow/DataSource/index.ts
apps/web/src/components/workflow/WorkflowDesigner.tsx
  </files>
  <action>
Create DataSourceForm.tsx for direct editing:
- All fields on single page (no wizard)
- Same fields as wizard but in form layout
- Collapsible sections: Connection, Input Schema, Output Schema
- Save button (submits to API)
- Delete button (with confirmation)
- Test Connection button

Create index.ts barrel export.

Update WorkflowDesigner.tsx to add "Data Source" tab:
- Tab bar: "Visual" | "YAML" | "Data Source"
- Data Source tab shows:
  - DataSourceWizard if no data source configured
  - DataSourceForm + DataPreview if configured
- Split view: form on left, preview on right
  </action>
  <verify>Edit existing data source, see updated preview</verify>
  <done>Data source form for editing, integrated into designer</done>
</task>

</tasks>

<verification>
1. Create new project - see data source wizard
2. Complete wizard - data source created
3. Edit data source - changes reflect in preview
4. Schema validation catches errors
</verification>

<success_criteria>
- Wizard guides through source type, connection, schema, confirm
- Schema editor validates JSON Schema
- Data preview shows one row at a time with navigation
- Form mode allows quick edits
- Test connection validates settings
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-project-configuration-experience/09.1-07-SUMMARY.md`
</output>
