---
phase: 09.1-project-configuration-experience
plan: 04
type: execute
wave: 2
depends_on: ["09.1-01", "09.1-02"]
files_modified:
  - apps/web/src/components/workflow/ConfigPanel/StepConfigPanel.tsx
  - apps/web/src/components/workflow/ConfigPanel/PanelHeader.tsx
  - apps/web/src/components/workflow/hooks/useStepConfig.ts
autonomous: true

must_haves:
  truths:
    - "Clicking a node opens config panel"
    - "Panel slides out from right (3/4 width)"
    - "Panel shows step-specific configuration options"
  artifacts:
    - path: "apps/web/src/components/workflow/ConfigPanel/StepConfigPanel.tsx"
      provides: "Step configuration slide-out panel"
      exports: ["StepConfigPanel"]
    - path: "apps/web/src/components/workflow/hooks/useStepConfig.ts"
      provides: "Step config state hook"
      exports: ["useStepConfig"]
  key_links:
    - from: "StepConfigPanel.tsx"
      to: "configStore.ts"
      via: "useConfigStore"
      pattern: "useConfigStore"
---

<objective>
Create the step configuration slide-out panel that opens when a node is selected.

Purpose: Users configure each workflow step through this panel. Per CONTEXT.md, it should be 3/4 width and slide out from the right when a node is selected.

Output: Working config panel shell with proper slide-out behavior and panel header.
</objective>

<execution_context>
@/Users/parthpatel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/parthpatel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/09.1-project-configuration-experience/09.1-CONTEXT.md
@.planning/phases/09.1-project-configuration-experience/09.1-01-SUMMARY.md
@apps/web/src/components/ui/sheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StepConfigPanel with slide-out behavior</name>
  <files>
apps/web/src/components/workflow/ConfigPanel/StepConfigPanel.tsx
apps/web/src/components/workflow/ConfigPanel/PanelHeader.tsx
apps/web/src/components/workflow/ConfigPanel/index.ts
  </files>
  <action>
Create StepConfigPanel.tsx:
- Use Sheet component from shadcn/ui (already in codebase)
- Configure as side="right" with custom width (75vw per CONTEXT.md "3/4 width")
- Open when canvasStore.selectedNodeId is set
- Close when clicking outside or pressing Escape
- Include PanelHeader and content area

Create PanelHeader.tsx:
- Shows step type icon and name
- Edit button for step name (inline edit)
- Delete button (with confirmation)
- Close button (X)

Panel structure:
```tsx
<Sheet open={!!selectedNodeId} onOpenChange={handleClose}>
  <SheetContent side="right" className="w-[75vw] sm:max-w-[75vw]">
    <PanelHeader node={selectedNode} onClose={handleClose} />
    <div className="flex-1 overflow-y-auto p-6">
      {/* Config forms will go here */}
      <StepConfigContent stepType={selectedNode.data.stepType} />
    </div>
  </SheetContent>
</Sheet>
```

Animation: Use Sheet's built-in slide animation.
  </action>
  <verify>Clicking node opens 3/4 width panel from right, clicking outside closes it</verify>
  <done>StepConfigPanel opens/closes correctly with header</done>
</task>

<task type="auto">
  <name>Task 2: Create useStepConfig hook and config content router</name>
  <files>
apps/web/src/components/workflow/hooks/useStepConfig.ts
apps/web/src/components/workflow/ConfigPanel/StepConfigContent.tsx
  </files>
  <action>
Create useStepConfig.ts hook:
- Takes nodeId as parameter
- Returns current config from configStore
- Returns updateConfig function that updates store and marks dirty
- Returns validation errors for this step
- Handles undo/redo for config changes

Create StepConfigContent.tsx as router component:
- Receives stepType prop
- Renders appropriate config form based on type:
  - start/end: minimal config (just name)
  - annotation/review/adjudication: full config (layout, consensus, assignment, completion)
  - auto_process: processor config
  - condition: expression editor
  - fork/join: parallel config
  - sub_workflow: workflow selector

For now, create placeholder components that show "Configuration for {stepType}".
Actual forms will be built in Plan 06.

Wire up useStepConfig in StepConfigContent to load/save config.
  </action>
  <verify>Panel content changes based on selected node type</verify>
  <done>Config hook manages step config state, content routes by type</done>
</task>

</tasks>

<verification>
1. Click annotation node - panel opens showing "Configuration for annotation"
2. Click condition node - panel shows "Configuration for condition"
3. Click outside panel - it closes
4. Escape key closes panel
</verification>

<success_criteria>
- Panel slides out from right when node selected
- Panel is 3/4 viewport width
- Header shows step type and name
- Content area routes based on step type
- Panel closes on outside click or Escape
</success_criteria>

<output>
After completion, create `.planning/phases/09.1-project-configuration-experience/09.1-04-SUMMARY.md`
</output>
